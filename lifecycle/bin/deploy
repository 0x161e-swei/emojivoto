#!/bin/sh

set -e

NAMESPACES=${1:-1}

if [ "$NAMESPACES" -gt 100 ]; then
  echo "Don't deploy more than 100 namespaces"
  exit 1
fi

echo "Deploying $NAMESPACES namespaces..."

for i in `seq 1 $NAMESPACES`;
do
  NS=lifecycle$i

  echo "\nDeploying $NS..."
  kubectl create ns $NS
  cat lifecycle.yml |
    conduit inject --conduit-namespace conduit-lifecycle - |
    kubectl -n $NS apply -f -
done
